/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import{logger as e}from"../logger.js";export function findNearestBreakpointLocation(e,t){if(0===e.length)return null;let r=e[0],c=Math.abs(r.columnNumber-t);for(let n=1;n<e.length;n++){const o=e[n],u=Math.abs(o.columnNumber-t);(u<c||u===c&&o.columnNumber<r.columnNumber)&&(r=o,c=u)}return r}export async function queryPossibleBreakpoints(t,r,c,n,o,u,i){try{const e={start:{scriptId:r,lineNumber:c,columnNumber:n},end:{scriptId:r,lineNumber:o,columnNumber:u}},s=await t.send("Debugger.getPossibleBreakpoints",e);return(s.locations||[]).map(e=>({scriptId:e.scriptId,scriptUrl:i,lineNumber:e.lineNumber+1,columnNumber:e.columnNumber}))}catch(t){return e(`[debugger] Failed to get possible breakpoints: ${t}`),[]}}const t=new WeakMap;export function getScriptCache(e){let r=t.get(e);return r||(r=new Map,t.set(e,r)),r}export function cacheScript(e,t){getScriptCache(e).set(t.scriptId,t)}export function clearScriptCache(e){const r=t.get(e);r&&r.clear()}export async function findMatchingScripts(t,r){const c=getScriptCache(t),n=new RegExp(r),o=[];for(const e of c.values())n.test(e.url)&&o.push(e);return o.length>0?o:(e(`[debugger] No cached scripts matching pattern: ${r}`),[])}export async function getScriptSource(t,r){const c=getScriptCache(t).get(r);if(void 0!==c?.source)return c.source;try{const e=(await t.send("Debugger.getScriptSource",{scriptId:r})).scriptSource||null;return c&&null!==e&&(c.source=e),e}catch(t){return e(`[debugger] Failed to get script source for ${r}: ${t}`),null}}export async function getAllScriptsWithSource(e,t){const r=getScriptCache(e),c=new Map,n=t?new RegExp(t):null;for(const[t,o]of r){if(n&&!n.test(o.url))continue;if(!o.url)continue;const r=await getScriptSource(e,t);null!==r&&c.set(t,{url:o.url,source:r})}return c}