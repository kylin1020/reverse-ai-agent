/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const t=new WeakMap;export async function getCdpSession(e){let n=t.get(e);return n||(n=await e.createCDPSession(),t.set(e,n)),n}export function disposeCdpSession(e){const n=t.get(e);n&&(n.detach().catch(()=>{}),t.delete(e))}export function hasCdpSession(e){return t.has(e)}export function formatStackTrace(t,e=""){const n=[];t.description&&n.push(`${e}${t.description}`);for(const o of t.callFrames){const t=o.functionName||"(anonymous)",r=`${o.url}:${o.lineNumber+1}:${o.columnNumber}`;n.push(`${e}  at ${t} (${r})`)}return t.parent&&(n.push(`${e}--- async ---`),n.push(...formatStackTrace(t.parent,e))),n}export function formatInitiator(t){const e=[];if(e.push(`Type: ${t.type}`),t.url){const n=void 0!==t.lineNumber?`${t.url}:${t.lineNumber+1}${void 0!==t.columnNumber?`:${t.columnNumber}`:""}`:t.url;e.push(`URL: ${n}`)}return t.stack&&(e.push(""),e.push("Call Stack:"),e.push(...formatStackTrace(t.stack,"  "))),e}const e=new WeakMap,n=new WeakSet;export async function enableNetworkInitiatorTracking(t){if(n.has(t))return;const o=await getCdpSession(t);e.set(t,new Map),o.on("Network.requestWillBeSent",n=>{if(n.initiator){const o=e.get(t);o&&o.set(n.requestId,n.initiator)}}),await o.send("Network.enable"),n.add(t)}export function getNetworkInitiator(t,n){const o=e.get(t);return o?.get(n)}export function clearNetworkInitiators(t){const n=e.get(t);n&&n.clear()}export function isNetworkTrackingEnabled(t){return n.has(t)}