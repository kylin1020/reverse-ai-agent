/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import{ScriptCacheRegistry as t}from"./scriptCacheRegistry.js";import{clearScriptCache as e}from"./smartBreakpointUtils.js";const n=new WeakMap;export async function getCdpSession(t){let e=n.get(t);return e||(e=await t.createCDPSession(),n.set(t,e)),e}export async function disposeCdpSession(r){const o=n.get(r);o&&(await t.remove(o),e(o),o.detach().catch(()=>{}),n.delete(r))}export function hasCdpSession(t){return n.has(t)}export function formatStackTrace(t,e=""){const n=[];t.description&&n.push(`${e}${t.description}`);for(const r of t.callFrames){const t=r.functionName||"(anonymous)",o=`${r.url}:${r.lineNumber+1}:${r.columnNumber}`;n.push(`${e}  at ${t} (${o})`)}return t.parent&&(n.push(`${e}--- async ---`),n.push(...formatStackTrace(t.parent,e))),n}export function formatInitiator(t){const e=[];if(e.push(`Type: ${t.type}`),t.url){const n=void 0!==t.lineNumber?`${t.url}:${t.lineNumber+1}${void 0!==t.columnNumber?`:${t.columnNumber}`:""}`:t.url;e.push(`URL: ${n}`)}return t.stack&&(e.push(""),e.push("Call Stack:"),e.push(...formatStackTrace(t.stack,"  "))),e}const r=new WeakMap,o=new WeakSet;export async function enableNetworkInitiatorTracking(t){if(o.has(t))return;const e=await getCdpSession(t);r.set(t,new Map),e.on("Network.requestWillBeSent",e=>{if(e.initiator){const n=r.get(t);n&&n.set(e.requestId,e.initiator)}}),await e.send("Network.enable"),o.add(t)}export function getNetworkInitiator(t,e){const n=r.get(t);return n?.get(e)}export function clearNetworkInitiators(t){const e=r.get(t);e&&e.clear()}export function isNetworkTrackingEnabled(t){return o.has(t)}