/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import{zod as e}from"../third_party/index.js";import{ToolCategory as a}from"./categories.js";import{defineTool as t}from"./ToolDefinition.js";export const screenshot=t({name:"take_screenshot",description:"Take a screenshot of the page or element.",annotations:{category:a.DEBUGGING,readOnlyHint:!1},schema:{format:e.enum(["png","jpeg","webp"]).default("png").describe('Type of format to save the screenshot as. Default is "png"'),quality:e.number().min(0).max(100).optional().describe("Compression quality for JPEG and WebP formats (0-100). Higher values mean better quality but larger file sizes. Ignored for PNG format."),uid:e.string().optional().describe("The uid of an element on the page from the page content snapshot. If omitted takes a pages screenshot."),fullPage:e.boolean().optional().describe("If set to true takes a screenshot of the full page instead of the currently visible viewport. Incompatible with uid."),filePath:e.string().optional().describe("The absolute path, or a path relative to the current working directory, to save the screenshot to instead of attaching it to the response.")},handler:async(e,a,t)=>{if(e.params.uid&&e.params.fullPage)throw new Error('Providing both "uid" and "fullPage" is not allowed.');let o;o=e.params.uid?await t.getElementByUid(e.params.uid):t.getSelectedPage();const s=e.params.format,r="png"===s?void 0:e.params.quality,i=await o.screenshot({type:s,fullPage:e.params.fullPage,quality:r,optimizeForSpeed:!0});if(e.params.uid?a.appendResponseLine(`Took a screenshot of node with uid "${e.params.uid}".`):e.params.fullPage?a.appendResponseLine("Took a screenshot of the full current page."):a.appendResponseLine("Took a screenshot of the current page's viewport."),e.params.filePath){const o=await t.saveFile(i,e.params.filePath);a.appendResponseLine(`Saved screenshot to ${o.filename}.`)}else if(i.length>=2e6){const{filename:o}=await t.saveTemporaryFile(i,`image/${e.params.format}`);a.appendResponseLine(`Saved screenshot to ${o}.`)}else a.attachImage({mimeType:`image/${e.params.format}`,data:Buffer.from(i).toString("base64")})}});